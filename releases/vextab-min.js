/**
 * VexTab 2.0.0 built on 2014-11-25.
 * Copyright (c) 2010 Mohit Muthanna Cheppudira <mohit@muthanna.com>
 *
 * http://www.vexflow.com  http://github.com/0xfe/vextab
 */

var parser=function(){function a(){this.yy={}}var b=function(a,b,c,d){for(c=c||{},d=a.length;d--;c[a[d]]=b);return c},c=[1,6],d=[1,7],e=[1,8],f=[1,9],g=[5,11,13,14,15],h=[5,11,13,14,15,17,19,21],i=[2,17],j=[1,14],k=[5,11,13,14,15,17,19,21,22],l=[1,18],m=[1,19],n=[1,20],o=[1,21],p=[1,43],q=[1,32],r=[1,33],s=[1,42],t=[1,41],u=[1,39],v=[1,48],w=[1,55],x=[1,50],y=[1,51],z=[1,52],A=[1,53],B=[1,54],C=[1,56],D=[1,44],E=[1,45],F=[1,46],G=[1,47],H=[1,57],I=[5,11,13,14,15,17,19,21,25],J=[5,11,13,14,15,17,19,21,23,31,32,37,38,45,48,57,61,62,63,64,65,66,70,71,73,75,76],K=[2,79],L=[1,67],M=[1,64],N=[1,65],O=[1,66],P=[1,73],Q=[1,74],R=[1,78],S=[1,79],T=[1,80],U=[1,81],V=[41,57,59,61,62,63,64,65,66,67,68,69],W=[38,45,48,76],X=[41,48,57,59,61,62,63,64,65,66,67,68,69,81],Y=[5,11,13,14,15,17,19,21,23,31,32,37,38,41,45,48,57,61,62,63,64,65,66,70,71,73,75,76],Z=[1,101],$=[44,46],ab=[2,63],bb=[1,106],cb=[5,11,13,14,15,17,19,21,23,31,32,37,38,45,48,57,59,61,62,63,64,65,66,70,71,73,75,76],db=[5,11,13,14,15,17,19,21,23,31,32,37,38,45,48,57,59,60,61,62,63,64,65,66,70,71,73,75,76],eb=[25,71],fb=[41,48,57,59,61,62,63,64,65,66,67,68,69],gb=[5,11,13,14,15,17,19,21,23,31,32,37,38,44,45,46,48,57,61,62,63,64,65,66,70,71,73,75,76],hb={trace:function(){},yy:{},symbols_:{error:2,e:3,maybe_vextab:4,EOF:5,vextab:6,stave:7,voice:8,maybe_options:9,stave_data:10,OPTIONS:11,options:12,TABSTAVE:13,STAVE:14,VOICE:15,stave_additions:16,TEXT:17,text:18,NOTES:19,notes:20,SLUR:21,WORD:22,"=":23,STR:24,",":25,lingo:26,line:27,chord:28,time:29,bar:30,"[":31,"]":32,tuplets:33,annotations:34,command:35,rest:36,"|":37,":":38,frets:39,maybe_decorator:40,"/":41,string:42,chord_line:43,".":44,"(":45,")":46,articulation:47,NUMBER:48,abc:49,_:50,timed_fret:51,time_values:52,maybe_dot:53,time_unit:54,maybe_slash:55,w:56,h:57,q:58,d:59,S:60,"-":61,s:62,t:63,T:64,b:65,p:66,v:67,V:68,u:69,"^":70,$:71,annotation_words:72,"!":73,COMMAND:74,"#":75,ABC:76,abc_accidental:77,accidental_type:78,"@":79,n:80,"~":81,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",11:"OPTIONS",13:"TABSTAVE",14:"STAVE",15:"VOICE",17:"TEXT",19:"NOTES",21:"SLUR",22:"WORD",23:"=",24:"STR",25:",",31:"[",32:"]",37:"|",38:":",41:"/",44:".",45:"(",46:")",48:"NUMBER",50:"_",56:"w",57:"h",58:"q",59:"d",60:"S",61:"-",62:"s",63:"t",64:"T",65:"b",66:"p",67:"v",68:"V",69:"u",70:"^",71:"$",73:"!",74:"COMMAND",75:"#",76:"ABC",79:"@",80:"n",81:"~"},productions_:[0,[3,2],[4,0],[4,1],[6,1],[6,2],[7,3],[7,2],[7,2],[8,1],[8,1],[8,1],[10,1],[10,2],[16,2],[16,2],[16,2],[9,0],[9,1],[12,3],[12,4],[18,1],[18,3],[20,1],[20,2],[26,1],[26,1],[26,1],[26,1],[26,1],[26,1],[26,1],[26,1],[26,1],[26,1],[30,1],[30,3],[30,3],[30,3],[30,3],[30,3],[27,4],[43,1],[43,3],[28,4],[28,5],[39,1],[39,1],[39,4],[39,2],[39,4],[51,5],[51,1],[51,5],[51,8],[51,1],[51,4],[29,3],[52,2],[54,1],[54,1],[54,1],[54,1],[53,0],[53,1],[55,0],[55,1],[42,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[47,1],[40,1],[40,1],[40,1],[40,1],[40,0],[33,3],[33,5],[34,3],[72,1],[72,3],[35,3],[36,2],[36,3],[36,4],[49,3],[77,1],[77,2],[77,1],[77,2],[77,1],[77,0],[78,0],[78,1]],performAction:function(a,b,c,d,e,f,g){var h=f.length-1;switch(e){case 1:return Vex.Flow.VexTab.DEBUG&&f[h-1]&&(console.log(f[h-1]),console.log(JSON.stringify(f[h-1],null," "))),f[h-1];case 2:case 17:case 79:this.$=null;break;case 3:case 12:case 18:case 23:case 25:case 26:case 27:case 42:case 59:case 60:case 61:case 62:case 67:this.$=f[h];break;case 4:case 83:this.$=[f[h]];break;case 5:this.$=[].concat(f[h-1],f[h]);break;case 6:this.$={element:f[h-2],options:f[h-1],notes:f[h].notes,text:f[h].text,_l:g[h-2].first_line,_c:g[h-2].first_column};break;case 7:this.$={element:f[h-1],options:f[h],_l:g[h-1].first_line,_c:g[h-1].first_column};break;case 8:this.$={element:"options",params:f[h],_l:g[h-1].first_line,_c:g[h-1].first_column};break;case 13:var i=[].concat(f[h-1].text,f[h].text),j=[].concat(f[h-1].notes,f[h].notes),k=[].concat(f[h-1].slurs,f[h].slurs);this.$={text:i,notes:j,slurs:k};break;case 14:this.$={text:f[h],notes:[],slurs:[]};break;case 15:this.$={notes:f[h],text:[],slurs:[]};break;case 16:this.$={slurs:f[h],notes:[],text:[]};break;case 19:this.$=[{key:f[h-2],value:f[h],_l:g[h-2].first_line,_c:g[h-2].first_column}];break;case 20:this.$=[].concat(f[h-3],[{key:f[h-2],value:f[h],_l:g[h-2].first_line,_c:g[h-2].first_column}]);break;case 21:this.$=[{text:f[h],_l:g[h].first_line,_c:g[h].first_column}];break;case 22:this.$=[].concat(f[h-2],{text:f[h],_l:g[h].first_line,_c:g[h].first_column});break;case 24:this.$=[].concat(f[h-1],f[h]);break;case 28:this.$=[{command:"bar",type:f[h],_l:g[h].first_line,_c:g[h].first_column}];break;case 29:this.$=[{command:"open_beam",_l:g[h].first_line,_c:g[h].first_column}];break;case 30:this.$=[{command:"close_beam",_l:g[h].first_line,_c:g[h].first_column}];break;case 31:this.$=[{command:"tuplet",params:f[h],_l:g[h].first_line,_c:g[h].first_column}];break;case 32:this.$=[{command:"annotations",params:f[h],_l:g[h].first_line,_c:g[h].first_column}];break;case 33:this.$=[{command:"command",params:f[h],_l:g[h].first_line,_c:g[h].first_column}];break;case 34:this.$=[{command:"rest",params:f[h]}];break;case 35:this.$="single";break;case 36:this.$="double";break;case 37:this.$="end";break;case 38:this.$="repeat-end";break;case 39:this.$="repeat-begin";break;case 40:this.$="repeat-both";break;case 41:_.extend(_.last(f[h-3]),{decorator:f[h-2]}),_.each(f[h-3],function(a){a.string=f[h]}),this.$=f[h-3];break;case 43:case 84:this.$=[].concat(f[h-2],f[h]);break;case 44:this.$=[{chord:f[h-2],decorator:f[h]}];break;case 45:this.$=[{chord:f[h-2],articulation:f[h-4],decorator:f[h]}];break;case 46:this.$=[{fret:f[h],_l:g[h].first_line,_c:g[h].first_column}];break;case 47:this.$=[{abc:f[h],_l:g[h].first_line,_c:g[h].first_column}];break;case 48:this.$=[{abc:f[h-3],octave:f[h-2],fret:f[h],_l:g[h-3].first_line,_c:g[h-3].first_column}];break;case 49:this.$=[_.extend(f[h],{articulation:f[h-1]})];break;case 50:_.extend(_.last(f[h-3]),{decorator:f[h-2]}),_.extend(f[h],{articulation:f[h-1]}),f[h-3].push(f[h]),this.$=f[h-3];break;case 51:this.$={time:f[h-3],dot:f[h-2],fret:f[h],_l:g[h-4].first_line,_c:g[h-4].first_column};break;case 52:this.$={fret:f[h],_l:g[h].first_line,_c:g[h].first_column};break;case 53:this.$={time:f[h-3],dot:f[h-2],abc:f[h]};break;case 54:this.$={time:f[h-6],dot:f[h-5],abc:f[h-3],octave:f[h-2],fret:f[h]};break;case 55:this.$={abc:f[h],_l:g[h].first_line,_c:g[h].first_column};break;case 56:this.$={abc:f[h-3],octave:f[h-2],fret:f[h],_l:g[h-3].first_line,_c:g[h-3].first_column};break;case 57:this.$={time:f[h-1],dot:f[h]};break;case 58:this.$=f[h-1]+f[h];break;case 63:this.$=!1;break;case 64:this.$=!0;break;case 65:this.$="";break;case 66:case 69:this.$="s";break;case 68:this.$="-";break;case 70:this.$="t";break;case 71:this.$="T";break;case 72:this.$="b";break;case 73:this.$="h";break;case 74:this.$="p";break;case 75:this.$="v";break;case 76:this.$="V";break;case 77:this.$="u";break;case 78:this.$="d";break;case 80:this.$={tuplet:f[h-1]};break;case 81:this.$={tuplet:f[h-3],notes:f[h-1]};break;case 82:case 85:this.$=f[h-1];break;case 86:this.$={position:0};break;case 87:this.$={position:f[h-1]};break;case 88:this.$={position:-1*f[h-1]};break;case 89:this.$={key:f[h-2],accidental:f[h-1],accidental_type:f[h]};break;case 90:this.$="#";break;case 91:this.$="##";break;case 92:this.$="b";break;case 93:this.$="bb";break;case 94:this.$="n";break;case 96:this.$=null;break;case 97:this.$="c"}},table:[{3:1,4:2,5:[2,2],6:3,7:4,8:5,11:c,13:d,14:e,15:f},{1:[3]},{5:[1,10]},{5:[2,3],7:11,8:5,11:c,13:d,14:e,15:f},b(g,[2,4]),b(h,i,{9:12,12:13,22:j}),{12:15,22:j},b(k,[2,9]),b(k,[2,10]),b(k,[2,11]),{1:[2,1]},b(g,[2,5]),b(g,[2,7],{10:16,16:17,17:l,19:m,21:n}),b(h,[2,18],{22:o}),{23:[1,22]},b(g,[2,8],{22:o}),b(g,[2,6],{16:23,17:l,19:m,21:n}),b(h,[2,12]),{18:24,24:[1,25]},{20:26,23:p,26:27,27:28,28:29,29:30,30:31,31:q,32:r,33:34,34:35,35:36,36:37,37:s,38:t,39:38,45:u,47:40,48:v,49:49,57:w,61:x,62:y,63:z,64:A,65:B,66:C,70:D,71:E,73:F,75:G,76:H},b(h,i,{12:13,9:58,22:j}),{23:[1,59]},{22:[1,60]},b(h,[2,13]),b(h,[2,14],{25:[1,61]}),b(I,[2,21]),b(h,[2,15],{27:28,28:29,29:30,30:31,33:34,34:35,35:36,36:37,39:38,47:40,49:49,26:62,23:p,31:q,32:r,37:s,38:t,45:u,48:v,57:w,61:x,62:y,63:z,64:A,65:B,66:C,70:D,71:E,73:F,75:G,76:H}),b(J,[2,23]),b(J,[2,25]),b(J,[2,26]),b(J,[2,27]),b(J,[2,28]),b(J,[2,29]),b(J,[2,30]),b(J,[2,31]),b(J,[2,32]),b(J,[2,33]),b(J,[2,34]),b([41,57,61,62,63,64,65,66],K,{40:63,59:L,67:M,68:N,69:O}),{27:69,39:38,43:68,47:70,48:v,49:49,57:w,61:x,62:y,63:z,64:A,65:B,66:C,76:H},{38:P,45:[1,71],48:Q,49:75,51:72,76:H},{48:R,52:76,54:77,56:S,57:T,58:U},b(J,[2,35]),{37:[1,82],38:[1,83]},{48:[1,84]},{22:[1,86],72:85},{74:[1,87]},{48:[1,89],61:[1,90],75:[1,88]},b(V,[2,46]),b(V,[2,47],{48:[1,91]}),b(W,[2,68]),b(W,[2,69]),b(W,[2,70]),b(W,[2,71]),b(W,[2,72]),b(W,[2,73]),b(W,[2,74]),b(X,[2,95],{77:92,75:[1,93],79:[1,94],80:[1,95]}),b(h,[2,16]),{22:[1,96]},b(k,[2,19]),{24:[1,97]},b(J,[2,24]),{41:[1,98],47:99,57:w,61:x,62:y,63:z,64:A,65:B,66:C},b(Y,[2,75]),b(Y,[2,76]),b(Y,[2,77]),b(Y,[2,78]),{44:Z,46:[1,100]},b($,[2,42]),{38:P,48:Q,49:75,51:72,76:H},{27:69,39:38,43:102,47:70,48:v,49:49,57:w,61:x,62:y,63:z,64:A,65:B,66:C,76:H},b(V,[2,49]),{48:R,52:103,54:77,56:S,57:T,58:U},b(V,[2,52]),b(V,[2,55],{48:[1,104]}),b(J,ab,{53:105,59:bb}),b(cb,[2,65],{55:107,60:[1,108]}),b(db,[2,59]),b(db,[2,60]),b(db,[2,61]),b(db,[2,62]),{23:[1,110],37:[1,109],38:[1,111]},{37:[1,112],38:[1,113]},{25:[1,115],70:[1,114]},{25:[1,117],71:[1,116]},b(eb,[2,83]),{73:[1,118]},b(J,[2,86]),{75:[1,119]},{48:[1,120]},{50:[1,121]},b(fb,[2,96],{78:122,81:[1,123]}),b(X,[2,90],{75:[1,124]}),b(X,[2,92],{79:[1,125]}),b(X,[2,94]),b(k,[2,20]),b(I,[2,22]),{42:126,48:[1,127]},{38:P,48:Q,49:75,51:128,76:H},b(J,K,{40:129,59:L,67:M,68:N,69:O}),{27:130,39:38,47:70,48:v,49:49,57:w,61:x,62:y,63:z,64:A,65:B,66:C,76:H},{44:Z,46:[1,131]},{38:ab,53:132,59:bb},{50:[1,133]},b(J,[2,57]),b(J,[2,64]),b(cb,[2,58]),b(cb,[2,66]),b(J,[2,36]),b(J,[2,37]),b(J,[2,39]),b(J,[2,38]),b(J,[2,40]),b(J,[2,80]),{48:[1,134]},b(J,[2,82]),{22:[1,135]},b(J,[2,85]),b(J,[2,87]),{75:[1,136]},{48:[1,137]},b(fb,[2,89]),b(fb,[2,97]),b(X,[2,91]),b(X,[2,93]),b(gb,[2,41]),b(gb,[2,67]),b(V,[2,50]),b(J,[2,44]),b($,[2,43]),b(J,K,{40:138,59:L,67:M,68:N,69:O}),{38:[1,139]},{48:[1,140]},{70:[1,141]},b(eb,[2,84]),b(J,[2,88]),b(V,[2,48]),b(J,[2,45]),{48:[1,142],49:143,76:H},b(V,[2,56]),b(J,[2,81]),b(V,[2,51]),b(V,[2,53],{48:[1,144]}),{50:[1,145]},{48:[1,146]},b(V,[2,54])],defaultActions:{10:[2,1]},parseError:function(a,b){if(!b.recoverable)throw new Error(a);this.trace(a)},parse:function(a){function b(){var a;return a=o.lex()||m,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0,l=2,m=1,n=f.slice.call(arguments,1),o=Object.create(this.lexer),p={yy:{}};for(var q in this.yy)Object.prototype.hasOwnProperty.call(this.yy,q)&&(p.yy[q]=this.yy[q]);o.setInput(a,p.yy),p.yy.lexer=o,p.yy.parser=this,"undefined"==typeof o.yylloc&&(o.yylloc={});var r=o.yylloc;f.push(r);var s=o.options&&o.options.ranges;this.parseError="function"==typeof p.yy.parseError?p.yy.parseError:Object.getPrototypeOf(this).parseError;for(var t,u,v,w,x,y,z,A,B,C={};;){if(v=d[d.length-1],this.defaultActions[v]?w=this.defaultActions[v]:((null===t||"undefined"==typeof t)&&(t=b()),w=g[v]&&g[v][t]),"undefined"==typeof w||!w.length||!w[0]){var D="";B=[];for(y in g[v])this.terminals_[y]&&y>l&&B.push("'"+this.terminals_[y]+"'");D=o.showPosition?"Parse error on line "+(i+1)+":\n"+o.showPosition()+"\nExpecting "+B.join(", ")+", got '"+(this.terminals_[t]||t)+"'":"Parse error on line "+(i+1)+": Unexpected "+(t==m?"end of input":"'"+(this.terminals_[t]||t)+"'"),this.parseError(D,{text:o.match,token:this.terminals_[t]||t,line:o.yylineno,loc:r,expected:B})}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+v+", token: "+t);switch(w[0]){case 1:d.push(t),e.push(o.yytext),f.push(o.yylloc),d.push(w[1]),t=null,u?(t=u,u=null):(j=o.yyleng,h=o.yytext,i=o.yylineno,r=o.yylloc,k>0&&k--);break;case 2:if(z=this.productions_[w[1]][1],C.$=e[e.length-z],C._$={first_line:f[f.length-(z||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(z||1)].first_column,last_column:f[f.length-1].last_column},s&&(C._$.range=[f[f.length-(z||1)].range[0],f[f.length-1].range[1]]),x=this.performAction.apply(C,[h,j,i,p.yy,w[1],e,f].concat(n)),"undefined"!=typeof x)return x;z&&(d=d.slice(0,-1*z*2),e=e.slice(0,-1*z),f=f.slice(0,-1*z)),d.push(this.productions_[w[1]][0]),e.push(C.$),f.push(C._$),A=g[d[d.length-2]][d[d.length-1]],d.push(A);break;case 3:return!0}}return!0}};Vex.L("Starting parser.");var ib=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw new Error(a);this.yy.parser.parseError(a,b)},setInput:function(a,b){return this.yy=b||this.yy||{},this._input=a,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,d,e;if(this.options.backtrack_lexer&&(e={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(e.yylloc.range=this.yylloc.range.slice(0))),d=a[0].match(/(?:\r\n?|\n).*/g),d&&(this.yylineno+=d.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:d?d[d.length-1].length-d[d.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length},this.yytext+=a[0],this.match+=a[0],this.matches=a,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(a[0].length),this.matched+=a[0],c=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),c)return c;if(this._backtrack){for(var f in e)this[f]=e[f];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d;this._more||(this.yytext="",this.match="");for(var e=this._currentRules(),f=0;f<e.length;f++)if(c=this._input.match(this.rules[e[f]]),c&&(!b||c[0].length>b[0].length)){if(b=c,d=f,this.options.backtrack_lexer){if(a=this.test_match(c,e[f]),a!==!1)return a;if(this._backtrack){b=!1;continue}return!1}if(!this.options.flex)break}return b?(a=this.test_match(b,e[d]),a!==!1?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){var a=this.conditionStack.length-1;return a>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){return a=this.conditionStack.length-1-Math.abs(a||0),a>=0?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,d){switch(c){case 0:return this.begin("notes"),19;case 1:return this.begin("options"),13;case 2:return this.begin("options"),14;case 3:return this.begin("options"),15;case 4:return this.begin("options"),11;case 5:return this.begin("text"),17;case 6:return this.begin("options"),21;case 7:return 22;case 8:return this.begin("annotations"),"$";case 9:return this.begin("notes"),"$";case 10:return 22;case 11:return this.begin("command"),"!";case 12:return this.begin("notes"),"!";case 13:return 74;case 14:return 24;case 15:return 41;case 16:return"+";case 17:return 38;case 18:return 23;case 19:return 45;case 20:return 46;case 21:return 31;case 22:return 32;case 23:return 70;case 24:return 25;case 25:return 37;case 26:return 44;case 27:return 75;case 28:return 79;case 29:return 65;case 30:return 62;case 31:return 57;case 32:return 66;case 33:return 63;case 34:return 64;case 35:return 61;case 36:return 50;case 37:return 67;case 38:return 68;case 39:return 69;case 40:return 59;case 41:return 48;case 42:return 58;case 43:return 56;case 44:return 57;case 45:return 59;case 46:return 60;case 47:return 76;case 48:return 80;case 49:return 81;case 50:this.begin("INITIAL");break;case 51:break;case 52:return 5;case 53:return"INVALID"}},rules:[/^(?:notes\b)/,/^(?:tabstave\b)/,/^(?:stave\b)/,/^(?:voice\b)/,/^(?:options\b)/,/^(?:text\b)/,/^(?:slur\b)/,/^(?:[^\s=]+)/,/^(?:[$])/,/^(?:[$])/,/^(?:[^,$]+)/,/^(?:[!])/,/^(?:[!])/,/^(?:[^!]+)/,/^(?:[^,\r\n]+)/,/^(?:\/)/,/^(?:\+)/,/^(?::)/,/^(?:=)/,/^(?:\()/,/^(?:\))/,/^(?:\[)/,/^(?:\])/,/^(?:\^)/,/^(?:,)/,/^(?:\|)/,/^(?:\.)/,/^(?:#)/,/^(?:@)/,/^(?:[b])/,/^(?:[s])/,/^(?:[h])/,/^(?:[p])/,/^(?:[t])/,/^(?:[T])/,/^(?:[-])/,/^(?:[_])/,/^(?:[v])/,/^(?:[V])/,/^(?:[u])/,/^(?:[d])/,/^(?:[0-9]+)/,/^(?:[q])/,/^(?:[w])/,/^(?:[h])/,/^(?:[d])/,/^(?:[S])/,/^(?:[A-GXLR])/,/^(?:[n])/,/^(?:[~])/,/^(?:[\r\n]+)/,/^(?:\s+)/,/^(?:$)/,/^(?:.)/],conditions:{notes:{rules:[8,11,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53],inclusive:!0},text:{rules:[14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,41,42,43,44,45,50,51,52,53],inclusive:!0},slur:{rules:[15,16,17,18,19,20,21,22,23,24,25,26,27,28,50,51,52,53],inclusive:!0},annotations:{rules:[9,10,15,16,17,18,19,20,21,22,23,24,25,26,27,28,50,51,52,53],inclusive:!0},options:{rules:[7,15,16,17,18,19,20,21,22,23,24,25,26,27,28,50,51,52,53],inclusive:!0},command:{rules:[12,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,50,51,52,53],inclusive:!0},INITIAL:{rules:[0,1,2,3,4,5,6,7,15,16,17,18,19,20,21,22,23,24,25,26,27,28,50,51,52,53],inclusive:!0}}};return a}();return hb.lexer=ib,a.prototype=hb,hb.Parser=a,new a}();(function(){var a=[].slice,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Vex.Flow.VexTab=function(){function c(a){this.artist=a,this.reset()}var d,e;return c.DEBUG=!1,d=function(){var b;return b=1<=arguments.length?a.call(arguments,0):[],Vex.Flow.VexTab.DEBUG&&"undefined"!=typeof console&&null!==console?console.log.apply(console,["(Vex.Flow.VexTab)"].concat(a.call(b))):void 0},e=function(a,b){return new Vex.RERR("ParseError",""+b+" in line "+a._l+" column "+a._c)},c.prototype.reset=function(){return this.valid=!1,this.elements=!1},c.prototype.isValid=function(){return this.valid},c.prototype.getArtist=function(){return this.artist},c.prototype.parseStaveOptions=function(a){var c,d,f,g,h,i,j,k,l,m,n,o,p;if(j={},null==a)return j;for(g=null,l=0,m=a.length;m>l;l++)switch(i=a[l],f=function(a){return e(i,a)},j[i.key]=i.value,i.key){case"notation":case"tablature":if(g=i,"true"!==(n=i.value)&&"false"!==n)throw f("'"+i.key+"' must be 'true' or 'false'");break;case"key":if(!_.has(Vex.Flow.keySignature.keySpecs,i.value))throw f("Invalid key signature '"+i.value+"'");break;case"clef":if(c=["treble","bass","tenor","alto","percussion","none"],o=i.value,b.call(c,o)<0)throw f("'clef' must be one of "+c.join(", "));break;case"voice":if(k=["top","bottom","new"],p=i.value,b.call(k,p)<0)throw f("'voice' must be one of "+k.join(", "));break;case"time":try{new Vex.Flow.TimeSignature(i.value)}catch(q){throw d=q,f("Invalid time signature: '"+i.value+"'")}break;case"tuning":try{new Vex.Flow.Tuning(i.value)}catch(q){throw d=q,f("Invalid tuning: '"+i.value+"'")}break;case"strings":if(h=parseInt(i.value),4>h||h>8)throw f("Invalid number of strings: "+h);break;default:throw f("Invalid option '"+i.key+"'")}if("false"===j.notation&&"false"===j.tablature)throw e(g,"Both 'notation' and 'tablature' can't be invisible");return j},c.prototype.parseCommand=function(a){return"bar"===a.command&&this.artist.addBar(a.type),"tuplet"===a.command&&this.artist.makeTuplets(a.params.tuplet,a.params.notes),"annotations"===a.command&&this.artist.addAnnotations(a.params),"rest"===a.command&&this.artist.addRest(a.params),"command"===a.command?this.artist.runCommand(a.params,a._l,a._c):void 0},c.prototype.parseChord=function(a){return d("parseChord:",a),this.artist.addChord(_.map(a.chord,function(a){return _.pick(a,"time","dot","fret","abc","octave","string","articulation","decorator")}),a.articulation,a.decorator)},c.prototype.parseFret=function(a){return this.artist.addNote(_.pick(a,"time","dot","fret","string","articulation","decorator"))},c.prototype.parseABC=function(a){return this.artist.addNote(_.pick(a,"time","dot","fret","abc","octave","string","articulation","decorator"))},c.prototype.parseStaveElements=function(a){var b,c,e,f;for(d("parseStaveElements:",a),f=[],c=0,e=a.length;e>c;c++)b=a[c],b.time&&this.artist.setDuration(b.time,b.dot),b.command&&this.parseCommand(b),b.chord&&this.parseChord(b),f.push(b.abc?this.parseABC(b):b.fret?this.parseFret(b):void 0);return f},c.prototype.parseStaveText=function(a){var b,c,d,f,g,h,i,j,k,l,m,n;for(_.isEmpty(a)||this.artist.addTextVoice(),h=0,g="center",i=!0,f=null,b=function(a){return function(){return a.artist.addTextNote("",0,g,!1,!0)}}(this),d=function(a){return function(b){var c,d;d=!1,"|"===b[0]&&(d=!0,b=b.slice(1));try{return a.artist.addTextNote(b,h,g,i,d)}catch(f){throw c=f,e(j,"Bad text or duration. Did you forget a comma?"+c)}}}(this),n=[],l=0,m=a.length;m>l;l++)if(j=a[l],k=j.text.trim(),k.match(/\.font=.*/))f=k.slice(6),n.push(this.artist.setTextFont(f));else if(":"===k[0])n.push(this.artist.setDuration(k));else if("."===k[0])switch(c=k.slice(1)){case"center":case"left":case"right":n.push(g=c);break;case"strict":n.push(i=!1);break;case"smooth":n.push(i=!0);break;case"bar":case"|":n.push(b());break;default:n.push(h=parseInt(k.slice(1),10))}else n.push("|"===k?b():"++"===k.slice(0,2)?this.artist.addTextVoice():d(k));return n},c.prototype.generate=function(){var a,b,c,d,f,g,h,i,j,k,l;for(j=this.elements,l=[],f=0,h=j.length;h>f;f++)switch(d=j[f],d.element){case"stave":case"tabstave":this.artist.addStave(d.element,this.parseStaveOptions(d.options)),null!=d.notes&&this.parseStaveElements(d.notes),l.push(null!=d.text?this.parseStaveText(d.text):void 0);break;case"voice":this.artist.addVoice(this.parseStaveOptions(d.options)),null!=d.notes&&this.parseStaveElements(d.notes),l.push(null!=d.text?this.parseStaveText(d.text):void 0);break;case"options":for(c={},k=d.params,g=0,i=k.length;i>g;g++)b=k[g],c[b.key]=b.value;try{l.push(this.artist.setOptions(c))}catch(m){throw a=m,e(d,a.message)}break;default:throw e(d,"Invalid keyword '"+d.element+"'")}return l},c.prototype.parse=function(a){var b,c;if(parser.parseError=function(a,b){throw d("VexTab parse error: ",a,b),a="Unexpected text '"+b.text+"' at line "+b.loc.first_line+" column "+b.loc.first_column+".",new Vex.RERR("ParseError",a)},null==a)throw new Vex.RERR("ParseError","No code");return d("Parsing:\n"+a),c=function(){var c,d,e,f;for(e=a.split(/\r\n|\r|\n/),f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.trim());return f}(),this.elements=parser.parse(c.join("\n")),this.elements&&(this.generate(),this.valid=!0),this.elements},c}(),Vex.Flow.Artist=function(){function c(a,b,c,d){this.x=a,this.y=b,this.width=c,this.options={font_face:"Arial",font_size:10,font_style:null,bottom_spacing:20+(Vex.Flow.Artist.NOLOGO?0:10),tab_stave_lower_spacing:10,note_stave_lower_spacing:0,scale:1},null!=d&&_.extend(this.options,d),this.reset()}var d,e,f,g,h,i,j,k;return c.DEBUG=!1,d=function(){var b;return b=1<=arguments.length?a.call(arguments,0):[],Vex.Flow.Artist.DEBUG&&"undefined"!=typeof console&&null!==console?console.log.apply(console,["(Vex.Flow.Artist)"].concat(a.call(b))):void 0},c.NOLOGO=!1,c.prototype.reset=function(){return this.tuning=new Vex.Flow.Tuning,this.key_manager=new Vex.Flow.KeyManager("C"),this.music_api=new Vex.Flow.Music,this.customizations={"font-size":this.options.font_size,"font-face":this.options.font_face,"font-style":this.options.font_style,"annotation-position":"bottom",scale:this.options.scale,width:this.width,"stave-distance":0,space:0,player:"false",tempo:120,instrument:"acoustic_grand_piano",accidentals:"standard","tab-stems":"false","tab-stem-direction":"up","beam-rests":"true","beam-stemlets":"true","beam-middle-only":"false","connector-space":0},this.staves=[],this.tab_articulations=[],this.stave_articulations=[],this.player_voices=[],this.last_y=this.y,this.current_duration="q",this.current_clef="treble",this.current_bends={},this.current_octave_shift=0,this.bend_start_index=null,this.bend_start_strings=null,this.rendered=!1,this.renderer_context=null},c.prototype.attachPlayer=function(a){return this.player=a},c.prototype.setOptions=function(a){var c,e,f;d("setOptions: ",a),f=_.keys(this.customizations);for(c in a){if(e=a[c],!(b.call(f,c)>=0))throw new Vex.RERR("ArtistError","Invalid option '"+c+"'");this.customizations[c]=e}return this.last_y+=parseInt(this.customizations.space,10),"true"===this.customizations.player?this.last_y+=15:void 0},c.prototype.getPlayerData=function(){return{voices:this.player_voices,context:this.renderer_context,scale:this.customizations.scale}},k=function(a){return"true"===a},e=function(a,b,c,d,e,f){var g,h,i,j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;if(null!=b&&(t=b.stave),null!=c&&(q=c.stave),u=[],r=[],w=[],i=[],j=null,v=null,h={beam_rests:k(e["beam-rests"]),show_stemlets:k(e["beam-stemlets"]),beam_middle_only:k(e["beam-middle-only"]),groups:f.beam_groups},null!=b){for(o=b.voices.length>1?!0:!1,E=b.voices,n=y=0,B=E.length;B>y;n=++y)p=E[n],_.isEmpty(p)||(_.each(p,function(a){return a.setStave(t)}),x=new Vex.Flow.Voice(Vex.Flow.TIME4_4).setMode(Vex.Flow.Voice.Mode.SOFT),x.addTickables(p),u.push(x),"true"===e["tab-stems"]&&(h.stem_direction=o?0===n?1:-1:"down"===e["tab-stem-direction"]?-1:1,h.beam_rests=!1,i=i.concat(Vex.Flow.Beam.generateBeams(x.getTickables(),h))));j=t,v=t}if(h.beam_rests=k(e["beam-rests"]),null!=c){for(o=c.voices.length>1?!0:!1,F=c.voices,n=z=0,C=F.length;C>z;n=++z)p=F[n],_.isEmpty(p)||(s=0===n?1:-1,_.each(p,function(a){return a.setStave(q)}),x=new Vex.Flow.Voice(Vex.Flow.TIME4_4).setMode(Vex.Flow.Voice.Mode.SOFT),x.addTickables(p),r.push(x),o?(h.stem_direction=s,i=i.concat(Vex.Flow.Beam.generateBeams(p,h))):(h.stem_direction=null,i=i.concat(Vex.Flow.Beam.generateBeams(p,h))));j=q,v=q}for(A=0,D=d.length;D>A;A++)p=d[A],_.isEmpty(p)||(_.each(p,function(a){return a.setStave(v)}),x=new Vex.Flow.Voice(Vex.Flow.TIME4_4).setMode(Vex.Flow.Voice.Mode.SOFT),x.addTickables(p),w.push(x));return null!=j?(l=[],m=new Vex.Flow.Formatter,g=!1,null!=b&&(_.isEmpty(u)||m.joinVoices(u),l=u),null!=c&&(_.isEmpty(r)||m.joinVoices(r),l=l.concat(r),r.length>1&&(g=!0)),_.isEmpty(d)||_.isEmpty(w)||(m.joinVoices(w),l=l.concat(w)),_.isEmpty(l)||m.formatToStave(l,j,{align_rests:g}),null!=b&&_.each(u,function(b){return b.draw(a,t)}),null!=c&&_.each(r,function(b){return b.draw(a,q)}),_.each(i,function(b){return b.setContext(a).draw()}),_.isEmpty(d)||_.each(w,function(b){return b.draw(a,v)}),null!=b&&null!=c&&new Vex.Flow.StaveConnector(c.stave,b.stave).setContext(a).draw(),null!=c?r:u):void 0},c.prototype.render=function(a){var b,c,f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(d("Render: ",this.options),this.closeBends(),a.resize(this.customizations.width*this.customizations.scale,(this.last_y+this.options.bottom_spacing)*this.customizations.scale),f=a.getContext(),f.scale(this.customizations.scale,this.customizations.scale),f.clear(),f.setFont(this.options.font_face,this.options.font_size,""),this.renderer_context=f,g=function(a,b){var c;return c=_.last(b),c instanceof Vex.Flow.BarNote?(b.pop(),a.setEndBarType(c.getType())):void 0},q=this.staves,k=0,n=q.length;n>k;k++)h=q[k],d("Rendering staves."),null!=h.tab&&g(h.tab,h.tab_notes),null!=h.note&&g(h.note,h.note_notes),null!=h.tab&&h.tab.setContext(f).draw(),null!=h.note&&h.note.setContext(f).draw(),h.tab_voices.push(h.tab_notes),h.note_voices.push(h.note_notes),i=e(f,null!=h.tab?{stave:h.tab,voices:h.tab_voices}:null,null!=h.note?{stave:h.note,voices:h.note_voices}:null,h.text_voices,this.customizations,{beam_groups:h.beam_groups}),this.player_voices.push(i);for(d("Rendering tab articulations."),r=this.tab_articulations,l=0,o=r.length;o>l;l++)c=r[l],c.setContext(f).draw();for(d("Rendering note articulations."),s=this.stave_articulations,m=0,p=s.length;p>m;m++)c=s[m],c.setContext(f).draw();return null!=this.player&&("true"===this.customizations.player?(this.player.setTempo(parseInt(this.customizations.tempo,10)),this.player.setInstrument(this.customizations.instrument),this.player.render()):this.player.removeControls()),this.rendered=!0,Vex.Flow.Artist.NOLOGO?void 0:(b="vexflow.com",j=f.measureText(b).width,f.save(),f.setFont("Times",10,"italic"),f.fillText(b,(this.customizations.width-j)/2,this.last_y+25),f.restore())},c.prototype.isRendered=function(){return this.rendered},c.prototype.draw=function(a){return this.render(a)},c.prototype.getNoteForFret=function(a,b){var c,d,e,f,g,h,i,j;switch(i=this.tuning.getNoteForFret(a,b),j=Vex.Flow.keyProperties(i),h=this.key_manager.selectNote(j.key),c=null,this.customizations.accidentals){case"standard":h.change&&(c=null!=h.accidental?h.accidental:"n");break;case"cautionary":c=h.change?null!=h.accidental?h.accidental:"n":null!=h.accidental?h.accidental+"_c":void 0;break;default:throw new Vex.RERR("ArtistError","Invalid value for option 'accidentals': "+this.customizations.accidentals)}return d=h.note,e=j.octave,g=this.music_api.getNoteParts(j.key).root,f=this.music_api.getNoteParts(h.note).root,"b"===f&&"c"===g?e--:"c"===f&&"b"===g&&e++,[d,e,c]},c.prototype.getNoteForABC=function(a,b){var c,d,e;
return d=a.key,e=b,c=a.accidental,null!=a.accidental_type&&(c+="_"+a.accidental_type),[d,e,c]},c.prototype.addStaveNote=function(a){var b,c,d,e,f,g,h,i,j,k;for(e={is_rest:!1,play_note:null},_.extend(e,a),h=_.last(this.staves).note_notes,g=new Vex.Flow.StaveNote({keys:e.spec,duration:this.current_duration+(e.is_rest?"r":""),clef:e.is_rest?"treble":this.current_clef,auto_stem:e.is_rest?!1:!0}),k=e.accidentals,c=i=0,j=k.length;j>i;c=++i)b=k[c],null!=b&&(f=b.split("_"),d=new Vex.Flow.Accidental(f[0]),f.length>1&&"c"===f[1]&&d.setAsCautionary(),g.addAccidental(c,d));return"d"===this.current_duration[this.current_duration.length-1]&&g.addDotToAll(),null!=e.play_note&&g.setPlayNote(e.play_note),h.push(g)},c.prototype.addTabNote=function(a,b){var c,d;return null==b&&(b=null),d=_.last(this.staves).tab_notes,c=new Vex.Flow.TabNote({positions:a,duration:this.current_duration},"true"===this.customizations["tab-stems"]),null!=b&&c.setPlayNote(b),d.push(c),"d"===this.current_duration[this.current_duration.length-1]?c.addDot():void 0},j=function(a,b){return a+(b?"d":"")},c.prototype.setDuration=function(a,b){var c;return null==b&&(b=!1),c=a.split(/\s+/),d("setDuration: ",c[0],b),this.current_duration=j(c[0],b)},c.prototype.addBar=function(a){var b,c,e;return d("addBar: ",a),this.closeBends(),this.key_manager.reset(),e=_.last(this.staves),b=Vex.Flow.Barline.type,a=function(){switch(a){case"single":return b.SINGLE;case"double":return b.DOUBLE;case"end":return b.END;case"repeat-begin":return b.REPEAT_BEGIN;case"repeat-end":return b.REPEAT_END;case"repeat-both":return b.REPEAT_BOTH;default:return b.SINGLE}}(),c=(new Vex.Flow.BarNote).setType(a),e.tab_notes.push(c),null!=e.note?e.note_notes.push(c):void 0},i=function(a,b){var c,d;return c=Vex.Flow.Bend.UP,d="",parseInt(a,10)>parseInt(b,10)?c=Vex.Flow.Bend.DOWN:d=function(){switch(Math.abs(b-a)){case 1:return"1/2";case 2:return"Full";case 3:return"1 1/2";default:return"Bend to "+b}}(),{type:c,text:d}},c.prototype.openBends=function(a,b,c,e){var f,g,h,j,k,l,m,n,o,p,q,r,s,t;for(d("openBends",a,b,c,e),o=_.last(this.staves).tab_notes,n=a,m=c,_.isEmpty(this.current_bends)?(this.bend_start_index=o.length-2,this.bend_start_strings=c):(n=o[this.bend_start_index],m=this.bend_start_strings),f=n.getPositions(),k=b.getPositions(),t=[],h=r=0,s=m.length;s>r;h=++r)j=m[h],l=e[h],g=a.getPositions()[c[h]],p=k[l],null==(q=this.current_bends)[j]&&(q[j]=[]),t.push(this.current_bends[j].push(i(g.fret,p.fret)));return t},c.prototype.closeBends=function(a){var b,c,e,f,g,h,i,j,k,l,m,n;if(null==a&&(a=1),null!=this.bend_start_index){d("closeBends("+a+")"),g=_.last(this.staves).tab_notes,m=this.current_bends;for(c in m){for(h=m[c],e=[],i=0,k=h.length;k>i;i++)b=h[i],e.push(b);g[this.bend_start_index].addModifier(new Vex.Flow.Bend(null,null,e),c)}for(n=g.slice(this.bend_start_index+1,+(g.length-2+a)+1||9e9),j=0,l=n.length;l>j;j++)f=n[j],f.setGhost(!0);return this.current_bends={},this.bend_start_index=null}},c.prototype.makeTuplets=function(a,b){var c,e,f,g;if(d("makeTuplets",a,b),null==b&&(b=a),_.last(this.staves).note){if(e=_.last(this.staves).note_notes,g=_.last(this.staves).tab_notes,e.length<b)throw new Vex.RERR("ArtistError","Not enough notes for tuplet");return c=new Vex.Flow.Tuplet(e.slice(e.length-b),{num_notes:a}),this.stave_articulations.push(c),f=new Vex.Flow.Tuplet(g.slice(g.length-b),{num_notes:a}),"true"===this.customizations["tab-stems"]?this.tab_articulations.push(f):void 0}},f=function(a){return a.match(/^\.fingering\/([^.]+)\./)},c.prototype.makeFingering=function(a){var b,c,d,e,g,h,i,j,k,l,m,n,o,p;if(l=f(a),b=Vex.Flow.Modifier.Position,g=[],e=[],null==l)return null;for(g=function(){var a,b,c,d;for(c=l[1].split(/-/),d=[],a=0,b=c.length;b>a;a++)k=c[a],d.push(k.trim());return d}(),c=function(){return new Vex.RERR("ArtistError","Bad fingering: "+l[1])},o=0,p=g.length;p>o;o++){if(d=g[o],m=d.match(/(\d+):([ablr]):([fs]):([^-.]+)/),null==m)throw c();switch(i=parseInt(m[1],10)-1,n=b.RIGHT,m[2]){case"l":n=b.LEFT;break;case"r":n=b.RIGHT;break;case"a":n=b.ABOVE;break;case"b":n=b.BELOW}switch(h=null,j=m[4],m[3]){case"s":h=new Vex.Flow.StringNumber(j).setPosition(n);break;case"f":h=new Vex.Flow.FretHandFinger(j).setPosition(n)}e.push({num:i,modifier:h})}return e},h=function(a){return a.match(/^\.stroke\/([^.]+)\./)},c.prototype.makeStroke=function(a){var b,c,d;if(c=h(a),b=Vex.Flow.Stroke.Type,d=null,null!=c){switch(c[1]){case"bu":d=b.BRUSH_UP;break;case"bd":d=b.BRUSH_DOWN;break;case"ru":d=b.ROLL_UP;break;case"rd":d=b.ROLL_DOWN;break;case"qu":d=b.RASQUEDO_UP;break;case"qd":d=b.RASQUEDO_DOWN;break;default:throw new Vex.RERR("ArtistError","Invalid stroke type: "+c[1])}return new Vex.Flow.Stroke(d)}return null},g=function(a){return a.match(/^\.(a[^\/]*)\/(t|b)[^.]*\./)},c.prototype.makeScoreArticulation=function(a){var b,c,d,e,f;return c=g(a),null!=c?(f=c[1],e=c[2],b=Vex.Flow.Modifier.Position,d="t"===e?b.ABOVE:b.BELOW,new Vex.Flow.Articulation(f).setPosition(d)):null},c.prototype.makeAnnotation=function(a){var b,c,d,e,f,g,h,i,j;if(e=this.customizations["font-face"],f=this.customizations["font-size"],g=this.customizations["font-style"],c=this.customizations["annotation-position"],b=Vex.Flow.Annotation.VerticalJustify,d="top"===c?b.TOP:b.BOTTOM,i=function(a,b){return null==b&&(b=d),new Vex.Flow.Annotation(a).setFont(e,f,g).setVerticalJustification(b)},j=a.match(/^\.([^-]*)-([^-]*)-([^.]*)\.(.*)/),null!=j)return e=j[1],f=j[2],g=j[3],a=j[4],a?i(a):null;if(j=a.match(/^\.([^.]*)\.(.*)/),null!=j){switch(h=d,a=j[2],j[1]){case"big":g="bold",f="14";break;case"italic":case"italics":e="Times",g="italic";break;case"medium":f="12";break;case"top":h=b.TOP,this.customizations["annotation-position"]="top";break;case"bottom":h=b.BOTTOM,this.customizations["annotation-position"]="bottom"}return a?i(a,h):null}return i(a)},c.prototype.addAnnotations=function(a){var b,c,d,e,f,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;if(k=_.last(this.staves),l=k.note_notes,o=k.tab_notes,a.length>o.length)throw new Vex.RERR("ArtistError","More annotations than note elements");if(k.tab)for(v=o.slice(o.length-a.length),f=p=0,s=v.length;s>p;f=++p)n=v[f],g(a[f])?(j=this.makeScoreArticulation(a[f]),n.addModifier(j,0)):h(a[f])?(m=this.makeStroke(a[f]),n.addModifier(m,0)):(b=this.makeAnnotation(a[f]),b&&n.addModifier(this.makeAnnotation(a[f]),0));else for(w=l.slice(l.length-a.length),f=q=0,t=w.length;t>q;f=++q)i=w[f],g(a[f])||(b=this.makeAnnotation(a[f]),b&&i.addAnnotation(0,this.makeAnnotation(a[f])));if(k.note){for(x=l.slice(l.length-a.length),y=[],f=r=0,u=x.length;u>r;f=++r)if(i=x[f],j=this.makeScoreArticulation(a[f]),null!=j&&i.addArticulation(0,j),m=this.makeStroke(a[f]),null!=m&&i.addStroke(0,m),e=this.makeFingering(a[f]),null!=e)try{y.push(function(){var a,b,c;for(c=[],a=0,b=e.length;b>a;a++)d=e[a],c.push(i.addModifier(d.num,d.modifier));return c}())}catch(z){throw c=z,new Vex.RERR("ArtistError","Bad note number in fingering: "+a[f])}else y.push(void 0);return y}},c.prototype.addTabArticulation=function(a,b,c,e,f){var g;return d("addTabArticulations: ",a,b,c,e,f),"t"===a&&c.addModifier(new Vex.Flow.Annotation("T").setVerticalJustification(Vex.Flow.Annotation.VerticalJustify.BOTTOM)),_.isEmpty(e)&&_.isEmpty(f)?void 0:(g=null,"s"===a&&(g=new Vex.Flow.TabSlide({first_note:b,last_note:c,first_indices:e,last_indices:f})),("h"===a||"p"===a)&&(g=new Vex.Flow.TabTie({first_note:b,last_note:c,first_indices:e,last_indices:f},a.toUpperCase())),("T"===a||"t"===a)&&(g=new Vex.Flow.TabTie({first_note:b,last_note:c,first_indices:e,last_indices:f}," ")),"b"===a&&this.openBends(b,c,e,f),null!=g?this.tab_articulations.push(g):void 0)},c.prototype.addStaveArticulation=function(a,b,c,e,f){var g;return d("addStaveArticulations: ",a,b,c,e,f),g=null,("b"===a||"s"===a||"h"===a||"p"===a||"t"===a||"T"===a)&&(g=new Vex.Flow.StaveTie({first_note:b,last_note:c,first_indices:e,last_indices:f})),null!=g?this.stave_articulations.push(g):void 0},c.prototype.getPreviousNoteIndex=function(){var a,b,c;for(c=_.last(this.staves).tab_notes,a=2;a<=c.length;){if(b=c[c.length-a],b instanceof Vex.Flow.TabNote)return c.length-a;a++}return-1},c.prototype.addDecorator=function(a){var b,c,e,f,g,h;return d("addDecorator: ",a),null!=a?(f=_.last(this.staves),g=f.tab_notes,e=f.note_notes,b=null,c=null,"v"===a&&(b=new Vex.Flow.Vibrato),"V"===a&&(b=(new Vex.Flow.Vibrato).setHarsh(!0)),"u"===a&&(b=new Vex.Flow.Articulation("a|").setPosition(Vex.Flow.Modifier.Position.BOTTOM),c=new Vex.Flow.Articulation("a|").setPosition(Vex.Flow.Modifier.Position.BOTTOM)),"d"===a&&(b=new Vex.Flow.Articulation("am").setPosition(Vex.Flow.Modifier.Position.BOTTOM),c=new Vex.Flow.Articulation("am").setPosition(Vex.Flow.Modifier.Position.BOTTOM)),null!=b&&_.last(g).addModifier(b,0),null!=c&&null!=(h=_.last(e))?h.addArticulation(0,c):void 0):void 0},c.prototype.addArticulations=function(a){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(d("addArticulations: ",a),o=_.last(this.staves),q=o.tab_notes,p=o.note_notes,_.isEmpty(q)||_.isEmpty(a))return void this.closeBends(0);for(f=_.last(q),g=!1,w=["b","s","h","p","t","T","v","V"],u=0,v=w.length;v>u;u++)s=w[u],i=function(){var b,d,e;for(e=[],h=b=0,d=a.length;d>b;h=++b)c=a[h],null!=c&&c===s&&e.push(h);return e}(),_.isEmpty(i)||("b"===s&&(g=!0),l=this.getPreviousNoteIndex(),-1===l?(n=null,m=null):(n=q[l],r=function(){var a,c,d,e;for(d=f.getPositions(),e=[],h=a=0,c=d.length;c>a;h=++a)j=d[h],b.call(i,h)>=0&&e.push(j.str);return e}(),t=function(){var a,c,d,e,f;for(d=n.getPositions(),f=[],h=a=0,c=d.length;c>a;h=++a)k=d[h],e=k.str,b.call(r,e)>=0&&f.push(k.str);return f}(),m=function(){var a,c,d,e,f;for(d=n.getPositions(),f=[],h=a=0,c=d.length;c>a;h=++a)j=d[h],e=j.str,b.call(t,e)>=0&&f.push(h);return f}(),e=function(){var a,c,d,e,g;for(d=f.getPositions(),g=[],h=a=0,c=d.length;c>a;h=++a)j=d[h],e=j.str,b.call(t,e)>=0&&g.push(h);return g}()),null!=o.tab&&this.addTabArticulation(s,n,f,m,e),null!=o.note&&this.addStaveArticulation(s,p[l],_.last(p),m,e));return g?void 0:this.closeBends(0)},c.prototype.addRest=function(a){var b,c,e;return d("addRest: ",a),this.closeBends(),0===a.position?this.addStaveNote({spec:["r/4"],accidentals:[],is_rest:!0}):(b=this.tuning.getNoteForFret(2*(parseInt(a.position,10)+5),6),this.addStaveNote({spec:[b],accidentals:[],is_rest:!0})),e=_.last(this.staves).tab_notes,"true"===this.customizations["tab-stems"]?(c=new Vex.Flow.StaveNote({keys:[b||"r/4"],duration:this.current_duration+"r",clef:"treble",auto_stem:!1}),"d"===this.current_duration[this.current_duration.length-1]&&c.addDot(0),e.push(c)):e.push(new Vex.Flow.GhostNote(this.current_duration))},c.prototype.addChord=function(a,b,c){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;if(!_.isEmpty(a)){for(d("addChord: ",a),B=_.last(this.staves),A=[],w=[],g=[],i=[],m=[],C=[],n=[],t=0,l=_.first(a).string,k=0,D=0,G=a.length;G>D;D++){if(r=a[D],t++,(null!=r.abc||r.string!==l)&&(k=0,l=r.string),null==A[k]&&(A[k]=[],w[k]=[],g[k]=[],C[k]=[],i[k]=[],m[k]=[]),I=[null,null,null],p=I[0],q=I[1],f=I[2],v=null,null!=r.abc)u=null!=r.octave?r.octave:r.string,J=this.getNoteForABC(r.abc,u),p=J[0],q=J[1],f=J[2],e=null!=f?f.split("_")[0]:"",v=""+p+e,null==r.fret&&(r.fret="X");else{if(null==r.fret)throw new Vex.RERR("ArtistError","No note specified");K=this.getNoteForFret(r.fret,r.string),p=K[0],q=K[1],f=K[2],v=this.tuning.getNoteForFret(r.fret,r.string).split("/")[0]}x=parseInt(q,10)+this.current_octave_shift,j=null!=r.time?{time:r.time,dot:r.dot}:null,A[k].push(""+p+"/"+q),w[k].push(""+v+"/"+x),g[k].push(f),C[k].push({fret:r.fret,str:r.string}),null!=r.articulation&&i[k].push(r.articulation),n[k]=j,null!=r.decorator&&(m[k]=r.decorator),k++}for(o=E=0,H=A.length;H>E;o=++E)z=A[o],y=this.current_duration,null!=n[o]&&this.setDuration(n[o].time,n[o].dot),this.addTabNote(C[o],w[o]),null!=B.note&&this.addStaveNote({spec:z,accidentals:g[o],play_note:w[o]}),this.addArticulations(i[o]),null!=m[o]&&this.addDecorator(m[o]);if(null!=b){for(h=[],s=F=1;t>=1?t>=F:F>=t;s=t>=1?++F:--F)h.push(b);this.addArticulations(h)}return null!=c?this.addDecorator(c):void 0}},c.prototype.addNote=function(a){return this.addChord([a])},c.prototype.addTextVoice=function(){return _.last(this.staves).text_voices.push([])},c.prototype.setTextFont=function(a){var b;return null!=a&&(b=a.match(/([^-]*)-([^-]*)-([^.]*)/),null!=b)?(this.customizations["font-face"]=b[1],this.customizations["font-size"]=parseInt(b[2],10),this.customizations["font-style"]=b[3]):void 0},c.prototype.addTextNote=function(a,b,c,d,e){var f,g,h,i,j,k,l,m;if(null==b&&(b=0),null==c&&(c="center"),null==d&&(d=!0),null==e&&(e=!1),m=_.last(this.staves).text_voices,_.isEmpty(m))throw new Vex.RERR("ArtistError","Can't add text note without text voice");return g=this.customizations["font-face"],h=this.customizations["font-size"],i=this.customizations["font-style"],j=function(){switch(c){case"center":return Vex.Flow.TextNote.Justification.CENTER;case"left":return Vex.Flow.TextNote.Justification.LEFT;case"right":return Vex.Flow.TextNote.Justification.RIGHT;default:return Vex.Flow.TextNote.Justification.CENTER}}(),f=e?"b":this.current_duration,l={text:a,duration:f,smooth:d,ignore_ticks:e,font:{family:g,size:h,weight:i}},"#"===a[0]&&(l.glyph=a.slice(1)),k=new Vex.Flow.TextNote(l).setLine(b).setJustification(j),_.last(m).push(k)},c.prototype.addVoice=function(a){var b;return this.closeBends(),b=_.last(this.staves),null==b?this.addStave(a):(_.isEmpty(b.tab_notes)||(b.tab_voices.push(b.tab_notes),b.tab_notes=[]),_.isEmpty(b.note_notes)?void 0:(b.note_voices.push(b.note_notes),b.note_notes=[]))},c.prototype.addStave=function(a,b){var c,e,f,g,h,i;f={tuning:"standard",clef:"treble",key:"C",notation:"tabstave"===a?"false":"true",tablature:"stave"===a?"false":"true",strings:6},_.extend(f,b),d("addStave: ",a,f),h=null,e=null,g=this.x+this.customizations["connector-space"],i=40,"true"===f.notation&&(e=new Vex.Flow.Stave(g,this.last_y,this.customizations.width-20),"none"!==f.clef&&e.addClef(f.clef),e.addKeySignature(f.key),null!=f.time&&e.addTimeSignature(f.time),this.last_y+=e.getHeight()+this.options.note_stave_lower_spacing+parseInt(this.customizations["stave-distance"],10),i=e.getNoteStartX(),this.current_clef="none"===f.clef?"treble":f.clef),"true"===f.tablature&&(h=new Vex.Flow.TabStave(g,this.last_y,this.customizations.width-20).setNumLines(f.strings),"none"!==f.clef&&h.addTabGlyph(),h.setNoteStartX(i),this.last_y+=h.getHeight()+this.options.tab_stave_lower_spacing),this.closeBends(),c=Vex.Flow.Beam.getDefaultBeamGroups(f.time),this.staves.push({tab:h,note:e,tab_voices:[],note_voices:[],tab_notes:[],note_notes:[],text_voices:[],beam_groups:c}),this.tuning.setTuning(f.tuning),this.key_manager.setKey(f.key)},c.prototype.runCommand=function(a,b,c){var e;switch(null==b&&(b=0),null==c&&(c=0),d("runCommand: ",a),e=a.split(/\s+/),e[0]){case"octave-shift":return this.current_octave_shift=parseInt(e[1],10),d("Octave shift: ",this.current_octave_shift);default:throw new Vex.RERR("ArtistError","Invalid command '"+e[0]+"' at line "+b+" column "+c)}},c}()}).call(this),Vex.Flow.TabDiv=function(a,b){arguments.length>0&&this.init(a,b)},Vex.Flow.TabDiv.SEL=".vex-tabdiv",Vex.Flow.TabDiv.ERROR_NOCANVAS="<b>This browser does not support HTML5 Canvas</b><br/>Please use a modern browser such as <a href='http://google.com/chrome'>Google Chrome</a> or <a href='http://firefox.com'>Firefox</a>.",Vex.Flow.TabDiv.prototype.init=function(a,b){this.sel=a,this.code=$(a).text(),$(a).empty(),"static"==$(a).css("position")&&$(a).css("position","relative"),this.width=parseInt($(a).attr("width"))||400,this.height=parseInt($(a).attr("height"))||200,this.scale=parseFloat($(a).attr("scale"))||1,"undefined"==typeof Raphael?(this.canvas=$("<canvas></canvas>").addClass("vex-canvas"),$(a).append(this.canvas),this.renderer=new Vex.Flow.Renderer(this.canvas[0],Vex.Flow.Renderer.Backends.CANVAS)):(this.canvas=$("<div></div>").addClass("vex-canvas"),$(a).append(this.canvas),this.renderer=new Vex.Flow.Renderer(this.canvas[0],Vex.Flow.Renderer.Backends.RAPHAEL)),this.ctx_sel=$(a).find(".vex-canvas"),this.renderer.resize(this.width,this.height),this.ctx=this.renderer.getContext(),this.ctx.setBackgroundFillStyle(this.ctx_sel.css("background-color")),this.ctx.scale(this.scale,this.scale),this.editor=$(a).attr("editor")||"",this.show_errors=$(a).attr("show-errors")||"",this.editor_width=$(a).attr("editor_width")||this.width,this.editor_height=$(a).attr("editor_height")||200;var c=this;"true"==this.editor&&(this.text_area=$("<textarea></textarea>").addClass("editor").val(this.code),this.editor_error=$("<div></div>").addClass("editor-error"),$(a).append($("<p/>")).append(this.editor_error),$(a).append($("<p/>")).append(this.text_area),this.text_area.width(this.editor_width),this.text_area.height(this.editor_height),this.text_area.keyup(function(){c.timeoutID&&window.clearTimeout(c.timeoutID),c.timeoutID=window.setTimeout(function(){c.code!=c.text_area.val()&&(c.code=c.text_area.val(),c.redraw())},250)})),"true"==this.show_errors&&(this.editor_error=$("<div></div>").addClass("editor-error"),$(a).append($("<p/>")).append(this.editor_error)),this.artist=new Vex.Flow.Artist(10,0,this.width,{scale:this.scale}),this.parser=new Vex.Flow.VexTab(this.artist),Vex.Flow.Player&&(opts={},b&&(opts.soundfont_url=b.soundfont_url),this.player=new Vex.Flow.Player(this.artist,opts)),this.redraw()},Vex.Flow.TabDiv.prototype.redraw=function(){var a=this;return Vex.BM("Total render time: ",function(){a.parse(),a.draw()}),this},Vex.Flow.TabDiv.prototype.drawInternal=function(){return this.parser.isValid()?this.artist.draw(this.renderer):this},Vex.Flow.TabDiv.prototype.parseInternal=function(){try{this.artist.reset(),this.parser.reset(),this.parser.parse(this.code),this.editor_error.empty()}catch(a){this.editor_error&&(this.editor_error.empty(),this.editor_error.append($("<div></div>").addClass("text").html("Sucky VexTab: "+a.message)))}return this},Vex.Flow.TabDiv.prototype.parse=function(){var a=this;return Vex.BM("Parse time: ",function(){a.parseInternal()}),this},Vex.Flow.TabDiv.prototype.draw=function(){var a=this;return Vex.BM("Draw time: ",function(){a.drawInternal()}),this},Vex.Flow.TabDiv.start=function(){$(Vex.Flow.TabDiv.SEL).each(function(){new Vex.Flow.TabDiv(this)})},$(function(){Vex.Flow.TabDiv.SEL&&Vex.Flow.TabDiv.start()});
//# sourceMappingURL=vextab-min.js.map